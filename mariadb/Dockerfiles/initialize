#  syntax = docker/dockerfile:1
#  check  = skip=SecretsUsedInArgOrEnv
#
#  The check triggers on "password", "password_file", etc...
#
#  FAQ: Does restore fail if passwords changed?
#    Maybe not if our password-files-in-root-folder are only used for
#    original initialization steps.
#
#  Also see:
#    https://stackoverflow.com/a/79156231
#    https://hub.docker.com/_/mariadb/;
#    https://mariadb.com/kb/en/mariadb-server-docker-official-image-environment-variables/;
#
####-####+####-####+####-####+####-####+####-####+####-####+####-####+####

# Bravo: https://stackoverflow.com/a/60820156.
ARG VERSION=default

FROM mariadb:11.6 AS data

# I just met a girl.
ARG MARIA=/root

# Root localhost-only? and her password.
ARG MARIADB_ROOT_HOST
ENV MARIADB_ROOT_HOST=$MARIADB_ROOT_HOST
ENV MARIADB_ROOT_PASSWORD_FILE="$MARIA/mariadb-root-password-file"

# MariaDB kindly sets up a user and database for us.
# Configure something for MediaWiki.
ARG MARIADB_DATABASE
ENV MARIADB_DATABASE=$MARIADB_DATABASE
ARG MARIADB_USER
ENV MARIADB_USER=$MARIADB_USER
ENV MARIADB_PASSWORD_FILE="$MARIA/mariadb-password-file"

# Place custom initialization steps inside /docker-entrypoint-initdb.d.
# Copy passwords to a safe place (/root).
COPY ./20-noop.sh /docker-entrypoint-initdb.d/
COPY --chmod=400 mariadb-root-password-file mariadb-password-file $MARIA/

# Dave, see https://stackoverflow.com/a/43656644.
# Don't repeat all of this in separate file(s); use --build-arg's.
# Do this after mediawiki dockerfile done. (Then you can test restore.)
# Best: https://stackoverflow.com/a/60820156.

# Original MariaDB entry point remains active.
