#
#  idave2/mediawiki image generator
#
#  See '.env' for environment defaults.
#
####-####+####-####+####-####+####-####+####-####+####-####+####-####+####

FROM mediawiki:1.39 AS view

# Copy LocalSettings.php generated by MediaWiki installation wizard.
COPY LocalSettings.php /var/www/html/

# Generate server's secret key.
RUN key=$(perl -we "print map { ('0'..'9','a'..'f')[int(rand(16))] } 1..64"); \
    perl -i.bak -pwe 's/^(\$wgSecretKey\s*=).*/$1 "'$key'";/' LocalSettings.php

####-####+####-####+####-####+####-####+####-####+####-####+####-####+####
#
#  The initial database -- mariadb/70-initdb.sql.gz -- was created after
#  manually running the MediaWiki update script,
#
#    $ php maintenance/update.php.
#
#  This script does "post installation" for whatever extensions are
#  activated; in our case, it creates table mediawiki.oathauth_users
#  for TOTP fun. Once initial database is checked in, this step does
#  not need repeating.
#
#  Original MariaDB entry point remains active.
